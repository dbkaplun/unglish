<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Unglish</title>
    <link rel="stylesheet" href="//cdn.quilljs.com/1.0.6/quill.bubble.css">
    <style>
html, body { margin: 0; height: 100%; }
    </style>
  </head>
  <body>
    <div id="quill"></div>
    <script src="//cdn.quilljs.com/1.0.6/quill.min.js" type="text/javascript"></script>
    <script>
function parse (text) {
  let body = new URLSearchParams();
  body.set('text', text);
  return fetch('/api/parse', {method: 'POST', body}).then(res => res.json());
}

let quill = new Quill('#quill', {
  modules: {
    toolbar: false,
    keyboard: {
      // disable formatting
      bindings: Object.keys(Quill.imports['modules/keyboard'].DEFAULTS.bindings).reduce((bindings, name) => {
        bindings[name] = {handler () {}}
        return bindings;
      }, {})
    }
  },
  placeholder: 'Enter some text...',
  theme: 'bubble'
});

quill.on('text-change', (newDelta, oldDelta, source) => {
  if (source !== 'user') return;
  let text = quill.getText();
  parse(text).then(terms => {
    console.log('parsed:', JSON.stringify(text), terms);
    quill.removeFormat(0, Infinity);
    let i = 0;
    terms.forEach(term => {
      let {text, tag, whitespace: {preceding, trailing}} = term;
      if (!text) return;
      i += preceding.length;
      quill.formatText(i, text.length, {
        Copula: {color: 'gray'}, /* is */
        Determiner: {color: 'gray'}, /* a */
        Preposition: {color: 'gray'}, /* in */
        Noun: {color: 'blue'}, /* world */
        Infinitive: {color: 'blue'}, /* test */
        Adjective: {color: 'green'}, /* awesome */
        Adverb: {color: 'yellow'}, /* so */
        PastTense: {color: 'gold'}, /* let */
        Verb: {color: 'gold'}, /* let */
        Question: {color: 'orange'}, /* so */
        Expression: {color: 'red'}, /* hello */
        Pronoun: {color: 'red'}, /* me */
        Demonym: {color: 'pink'}, /* English */
      }[tag] || {background: 'red'});
      i += text.length + trailing.length;
    });
  });
});
     </script>
  </body>
</html>
